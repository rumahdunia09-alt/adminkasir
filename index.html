<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IKAMAPUSAT - Professional Cloud POS</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --sidebar-w: 240px; --primary: #2c3e50; --accent: #3498db; --bg: #f8f9fa; --white: #ffffff; }
        * { box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; margin: 0; background: var(--bg); display: flex; color: #333; }
        
        /* Login Styles */
        #loginPage { position: fixed; inset: 0; background: linear-gradient(135deg, #2c3e50, #34495e); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .login-card { background: white; padding: 40px; border-radius: 15px; width: 350px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        
        /* Sidebar */
        #sidebar { width: var(--sidebar-w); background: var(--primary); height: 100vh; color: white; position: fixed; transition: 0.3s; }
        #sidebar .logo { padding: 25px; text-align: center; font-weight: bold; font-size: 20px; border-bottom: 1px solid #3e4f5f; }
        #sidebar nav { padding: 20px 0; }
        .nav-item { padding: 15px 25px; cursor: pointer; display: flex; align-items: center; gap: 15px; transition: 0.2s; color: #bdc3c7; }
        .nav-item:hover, .nav-item.active { background: var(--accent); color: white; }

        /* Main Content */
        #main { margin-left: var(--sidebar-w); width: calc(100% - var(--sidebar-w)); min-height: 100vh; }
        header { background: var(--white); padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .content-area { padding: 30px; }
        .page { display: none; animation: fadeIn 0.3s; }
        .page.active { display: block; }

        /* Cards & Components */
        .card { background: var(--white); border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 20px; border: none; }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { padding: 25px; border-radius: 15px; color: white; position: relative; overflow: hidden; }
        .blue { background: linear-gradient(45deg, #3498db, #2980b9); }
        .green { background: linear-gradient(45deg, #2ecc71, #27ae60); }
        .orange { background: linear-gradient(45deg, #f39c12, #d35400); }
        
        input, select, button { padding: 12px; margin: 8px 0; border-radius: 8px; border: 1px solid #ddd; width: 100%; font-size: 14px; }
        button { background: var(--accent); color: white; border: none; font-weight: 600; cursor: pointer; transition: 0.3s; }
        button:hover { opacity: 0.9; transform: translateY(-1px); }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
        th { font-weight: 600; color: #7f8c8d; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="loginPage">
        <div class="login-card">
            <img src="logo.png" width="80" onerror="this.style.display='none'">
            <h2>IKAMAPUSAT</h2>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button onclick="doLogin()">SIGN IN</button>
        </div>
    </div>

    <div id="sidebar" style="display:none">
        <div class="logo">IKAMAPUSAT</div>
        <nav>
            <div class="nav-item active" onclick="showPage('dash')"><i class="fas fa-home"></i> Dashboard</div>
            <div class="nav-item" onclick="showPage('kasir')"><i class="fas fa-shopping-cart"></i> Kasir</div>
            <div class="nav-item admin-only" onclick="showPage('master')"><i class="fas fa-box"></i> Master Barang</div>
            <div class="nav-item" onclick="showPage('laporan')"><i class="fas fa-file-invoice"></i> Laporan</div>
            <div class="nav-item admin-only" onclick="showPage('users')"><i class="fas fa-users"></i> Management User</div>
        </nav>
    </div>

    <div id="main" style="display:none">
        <header>
            <div id="pageTitle">Dashboard Overview</div>
            <div style="display:flex; align-items:center; gap:15px">
                <span id="displayUser" style="font-weight:600"></span>
                <button onclick="location.reload()" style="width:auto; background:#e74c3c; padding:8px 15px">Logout</button>
            </div>
        </header>

        <div class="content-area">
            <div id="dashPage" class="page active">
                <div class="stat-grid">
                    <div class="stat-card blue"><small>Pendapatan Hari Ini</small><h2 id="omzetHariIni">Rp 0</h2></div>
                    <div class="stat-card green"><small>Profit Bersih</small><h2 id="profitHariIni">Rp 0</h2></div>
                    <div class="stat-card orange"><small>Total Transaksi</small><h2 id="trxHariIni">0</h2></div>
                </div>
                <div class="card">
                    <h3>Aktivitas Terbaru</h3>
                    <table id="recentTrx">
                        <thead><tr><th>Waktu</th><th>Metode</th><th>Total</th></tr></thead>
                        <tbody id="bodyRecent"></tbody>
                    </table>
                </div>
            </div>

            <div id="kasirPage" class="page">
                <div class="grid" style="display:grid; grid-template-columns: 2fr 1fr; gap:20px;">
                    <div class="card">
                        <h3>Transaksi Baru</h3>
                        <input type="text" id="scanKasir" placeholder="Scan Barcode / Nama Barang..." onkeypress="handleKasirScan(event)">
                        <table>
                            <thead><tr><th>Barang</th><th>Qty</th><th>Subtotal</th></tr></thead>
                            <tbody id="bodyKeranjang"></tbody>
                        </table>
                    </div>
                    <div class="card">
                        <h2 id="totalBelanja" style="color:var(--accent)">Rp 0</h2>
                        <select id="metodeBayar"><option>Tunai</option><option>QRIS/DANA</option></select>
                        <input type="number" id="bayar" placeholder="Nominal Bayar" oninput="hitungKembalian()">
                        <h3 id="kembalian" style="color:#e74c3c">Kembali: 0</h3>
                        <button class="btn-s" style="background:#2ecc71" onclick="prosesTransaksi()">SELESAIKAN PEMBAYARAN</button>
                    </div>
                </div>
            </div>

            <div id="masterPage" class="page">
                <div class="card">
                    <h3>Tambah / Import Barang</h3>
                    <div style="display:flex; gap:10px; margin-bottom:15px">
                        <input type="file" id="csvFile" style="width:auto">
                        <button onclick="importCSV()" style="width:auto">Import CSV</button>
                    </div>
                    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                        <input type="text" id="m_kode" placeholder="Kode/Barcode">
                        <input type="text" id="m_nama" placeholder="Nama Barang">
                        <input type="number" id="m_modal" placeholder="Harga Modal">
                        <input type="number" id="m_harga" placeholder="Harga Jual">
                        <input type="number" id="m_stok" placeholder="Stok Awal">
                        <button onclick="tambahBarang()">SIMPAN DATA</button>
                    </div>
                </div>
                <div class="card">
                    <table><thead><tr><th>Kode</th><th>Nama</th><th>Stok</th><th>Harga</th><th>Aksi</th></tr></thead><tbody id="bodyMaster"></tbody></table>
                </div>
            </div>

            <div id="laporanPage" class="page">
                <div class="card">
                    <input type="date" id="filterTanggal" style="width:200px" onchange="renderRiwayat()">
                    <table><thead><tr><th>Waktu</th><th>Kasir</th><th>Total</th><th>Aksi</th></tr></thead><tbody id="bodyRiwayat"></tbody></table>
                </div>
            </div>

            <div id="usersPage" class="page">
                <div class="card">
                    <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;">
                        <input type="text" id="u_nama" placeholder="Nama Lengkap">
                        <input type="text" id="u_user" placeholder="Username">
                        <input type="password" id="u_pass" placeholder="Password">
                        <button onclick="tambahUser()">TAMBAH KASIR</button>
                    </div>
                    <table><thead><tr><th>Nama</th><th>Username</th><th>Aksi</th></tr></thead><tbody id="bodyUsers"></tbody></table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // CONFIG SAMA SEPERTI v12 TAPI DENGAN DATABASE REF v13
        const firebaseConfig = {
            apiKey: "AIzaSyAvJdH3fnfUvupwtRDbSvhBjiY3tIxXnW0",
            authDomain: "kasir-ikamapusat.firebaseapp.com",
            databaseURL: "https://kasir-ikamapusat-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kasir-ikamapusat",
            storageBucket: "kasir-ikamapusat.firebasestorage.app",
            messagingSenderId: "375649394523",
            appId: "1:375649394523
