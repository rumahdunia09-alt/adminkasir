<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IKAMAPUSAT - Pro Inventory v18</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --p: #2c3e50; --a: #3498db; --s: #27ae60; --d: #e74c3c; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--bg); display: flex; }
        
        #sidebar { width: 240px; background: var(--p); height: 100vh; color: white; position: fixed; display: none; }
        .nav-item { padding: 15px 20px; cursor: pointer; display: flex; align-items: center; gap: 12px; color: #bdc3c7; }
        .nav-item:hover, .nav-item.active { background: var(--a); color: white; }

        #main { margin-left: 240px; width: calc(100% - 240px); display: none; }
        header { background: white; padding: 15px 30px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .container { padding: 25px; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        
        .grid-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; }
        input, select, button { padding: 10px; border-radius: 6px; border: 1px solid #ddd; width: 100%; box-sizing: border-box; }
        button { background: var(--a); color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-import { background: var(--s); width: auto; padding: 10px 20px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; font-size: 13px; }
        th { background: #fafafa; }
        .badge { padding: 3px 8px; border-radius: 4px; font-size: 11px; background: #eee; color: #555; }

        #loginPage { position: fixed; inset: 0; background: var(--p); display: flex; align-items: center; justify-content: center; z-index: 999; }
        .login-box { background: white; padding: 40px; border-radius: 12px; width: 320px; text-align: center; }
    </style>
</head>
<body>

    <div id="loginPage">
        <div class="login-box">
            <h2>IKAMAPUSAT</h2>
            <input type="text" id="user" placeholder="Username">
            <input type="password" id="pass" placeholder="Password">
            <button onclick="login()">MASUK</button>
        </div>
    </div>

    <div id="sidebar">
        <div style="padding:25px; font-weight:bold; font-size:18px; border-bottom:1px solid #34495e">POS INVENTORY</div>
        <nav style="margin-top:10px">
            <div class="nav-item active" onclick="show('dash',this)"><i class="fas fa-tachometer-alt"></i> Dashboard</div>
            <div class="nav-item" onclick="show('kasir',this)"><i class="fas fa-shopping-cart"></i> Kasir</div>
            <div class="nav-item" onclick="show('master',this)"><i class="fas fa-boxes"></i> Master Barang</div>
            <div class="nav-item" onclick="show('riwayat',this)"><i class="fas fa-history"></i> Riwayat</div>
        </nav>
    </div>

    <div id="main">
        <header>
            <div id="pageTitle" style="font-weight:bold">DASHBOARD</div>
            <button onclick="location.reload()" style="width:auto; background:var(--d)">Logout</button>
        </header>

        <div class="container">
            <div id="dashPage" class="page" style="display:block">
                <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:20px">
                    <div class="card">Total Item <h2 id="cB">0</h2></div>
                    <div class="card">Total Stok <h2 id="cS">0</h2></div>
                    <div class="card">Nilai Aset <h2 id="cA">Rp 0</h2></div>
                </div>
            </div>

            <div id="kasirPage" class="page" style="display:none">
                <div class="card">
                    <input type="text" id="scan" placeholder="Scan Barcode / Cari Nama..." onkeypress="cari(event)">
                    <table>
                        <thead><tr><th>Produk</th><th>Satuan</th><th>Qty</th><th>Subtotal</th></tr></thead>
                        <tbody id="cartBody"></tbody>
                    </table>
                    <h2 id="totalH" style="text-align:right">Total: Rp 0</h2>
                    <button onclick="bayar()" style="background:var(--s); padding:15px">SELESAIKAN PEMBAYARAN</button>
                </div>
            </div>

            <div id="masterPage" class="page" style="display:none">
                <div class="card">
                    <h3>Import / Export Excel</h3>
                    <div style="background:#f9f9f9; padding:15px; border-radius:8px; border:2px dashed #ddd">
                        <input type="file" id="inpCsv" accept=".csv" style="width:auto">
                        <button class="btn-import" onclick="importCsv()"><i class="fas fa-upload"></i> Import CSV</button>
                        <button class="btn-import" style="background:var(--a)" onclick="exportCsv()"><i class="fas fa-download"></i> Export CSV</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Tambah Barang Manual</h3>
                    <div class="grid-form">
                        <input type="text" id="mk" placeholder="Barcode">
                        <input type="text" id="mn" placeholder="Nama Barang">
                        <input type="text" id="mkat" placeholder="Kategori (Makanan/Lainnya)">
                        <select id="msat">
                            <option value="pcs">Pcs</option>
                            <option value="kg">Kg</option>
                            <option value="liter">Liter</option>
                            <option value="dus">Dus</option>
                        </select>
                        <input type="number" id="mmodal" placeholder="Harga Modal">
                        <input type="number" id="mjual" placeholder="Harga Jual">
                        <input type="number" id="mstok" placeholder="Stok">
                        <button onclick="addManual()" style="background:var(--s)">TAMBAH</button>
                    </div>
                </div>

                <div class="card" style="overflow-x:auto">
                    <table id="tblMaster">
                        <thead><tr><th>Kode</th><th>Barang</th><th>Kategori</th><th>Satuan</th><th>Modal</th><th>Jual</th><th>Stok</th></tr></thead>
                        <tbody id="mBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="riwayatPage" class="page" style="display:none">
                <div class="card"><table><thead><tr><th>Waktu</th><th>Total</th></tr></thead><tbody id="rBody"></tbody></table></div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAvJdH3fnfUvupwtRDbSvhBjiY3tIxXnW0",
            authDomain: "kasir-ikamapusat.firebaseapp.com",
            databaseURL: "https://kasir-ikamapusat-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "kasir-ikamapusat",
            storageBucket: "kasir-ikamapusat.firebasestorage.app",
            messagingSenderId: "375649394523",
            appId: "1:375649394523:web:1e13212c1f9c1d8829447e"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let lB = [], lR = [], ker = [];

        db.ref('v18_barang').on('value', s => { 
            lB = s.val() || []; renM(); 
            let stok = 0, aset = 0;
            lB.forEach(b => { stok += Number(b.stok); aset += (Number(b.modal) * Number(b.stok)); });
            cB.innerText = lB.length; cS.innerText = stok; cA.innerText = "Rp " + aset.toLocaleString();
        });
        db.ref('v18_riwayat').on('value', s => { lR = s.val() || []; renR(); });

        function login() { if(user.value=='admin' && pass.value=='123'){ loginPage.style.display='none'; sidebar.style.display='block'; main.style.display='block'; } else alert("Salah!"); }
        
        function show(id, el) { 
            document.querySelectorAll('.page').forEach(p => p.style.display='none');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id+'Page').style.display='block';
            el.classList.add('active');
            pageTitle.innerText = id.toUpperCase();
        }

        function renM() { 
            mBody.innerHTML=''; 
            lB.forEach(b => mBody.innerHTML+=`<tr><td>${b.kode}</td><td>${b.nama}</td><td><span class="badge">${b.kategori}</span></td><td>${b.satuan}</td><td>${Number(b.modal).toLocaleString()}</td><td>${Number(b.harga).toLocaleString()}</td><td>${b.stok}</td></tr>`); 
        }

        function renR() { rBody.innerHTML=''; lR.forEach(r => rBody.innerHTML+=`<tr><td>${r.waktu}</td><td>Rp ${r.total.toLocaleString()}</td></tr>`); }

        function importCsv() {
            const file = inpCsv.files[0];
            if (!file) return alert("Pilih file!");
            const reader = new FileReader();
            reader.onload = function(e) {
                const rows = e.target.result.split("\n");
                rows.forEach((row, i) => {
                    if (i === 0 || row.trim() === "") return;
                    const c = row.split(",");
                    if (c.length >= 7) {
                        lB.push({ kode:c[0].trim(), nama:c[1].trim(), kategori:c[2].trim(), satuan:c[3].trim(), modal:parseInt(c[4]), harga:parseInt(c[5]), stok:parseInt(c[6]) });
                    }
                });
                db.ref('v18_barang').set(lB);
                alert("Berhasil!");
            };
            reader.readAsText(file);
        }

        function exportCsv() {
            let csv = "KODE,NAMA,KATEGORI,SATUAN,MODAL,JUAL,STOK\n";
            lB.forEach(b => csv += `${b.kode},${b.nama},${b.kategori},${b.satuan},${b.modal},${b.harga},${b.stok}\n`);
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'Data_Barang_V18.csv'; a.click();
        }

        function cari(e) {
            if(e.key === 'Enter') {
                const b = lB.find(x => x.kode === scan.value || x.nama.toLowerCase().includes(scan.value.toLowerCase()));
                if(b) { ker.push({...b, qty:1}); renC(); }
                scan.value = '';
            }
        }
        function renC() { cartBody.innerHTML=''; let t=0; ker.forEach(k => { let s=k.qty*k.harga; t+=s; cartBody.innerHTML+=`<tr><td>${k.nama}</td><td>${k.satuan}</td><td>${k.qty}</td><td>${s.toLocaleString()}</td></tr>`; }); totalH.innerText="Total: Rp "+t.toLocaleString(); }
        
        function bayar() {
            const t = parseInt(totalH.innerText.replace(/\D/g,''));
            if(t===0) return;
            lR.unshift({ waktu: new Date().toLocaleString(), total: t });
            db.ref('v18_riwayat').set(lR);
            alert("Selesai!"); ker=[]; renC();
        }

        function addManual() {
            lB.push({ kode:mk.value, nama:mn.value, kategori:mkat.value, satuan:msat.value, modal:parseInt(mmodal.value), harga:parseInt(mjual.value), stok:parseInt(mstok.value) });
            db.ref('v18_barang').set(lB);
            alert("Tersimpan!");
            mk.value=''; mn.value=''; mkat.value=''; mmodal.value=''; mjual.value=''; mstok.value='';
        }
    </script>
</body>
</html>
